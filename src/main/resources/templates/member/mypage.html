<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/common :: common-resources}"></th:block>
    <title>내 정보</title>
    <style>
        .info-group {
            display: flex;
            align-items: center;
            padding: 0.75em 0;
            border-bottom: 1px solid #eee;
        }
        .info-group:last-child {
            border-bottom: none;
        }
        .info-label {
            flex-basis: 120px;
            font-weight: 600;
            color: #555;
        }
        .info-value {
            flex-grow: 1;
            color: #333;
        }
    </style>
</head>
<body class="bg-light">
<!-- 상단 바 -->
<div th:replace="~{fragments/topbar :: topbar}"></div>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h2 class="card-title text-center mb-0">내 정보</h2>
                </div>
                <div class="card-body p-4">
                    <!-- 정보 로딩 시 보여줄 스피너 -->
                    <div id="info-loader" class="text-center py-5">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">정보를 불러오는 중...</p>
                    </div>

                    <div id="info-content" class="d-none">
                        <div class="info-group">
                            <span class="info-label"><i class="bi bi-person-badge me-2"></i>아이디</span>
                            <span id="info-loginId" class="info-value"></span>
                        </div>
                        <div class="info-group">
                            <span class="info-label"><i class="bi bi-person me-2"></i>이름</span>
                            <span id="info-name" class="info-value"></span>
                        </div>
                        <div class="info-group">
                            <span class="info-label"><i class="bi bi-envelope me-2"></i>이메일</span>
                            <span id="info-email" class="info-value"></span>
                        </div>
                        <div class="info-group">
                            <span class="info-label"><i class="bi bi-award me-2"></i>역할</span>
                            <span id="info-role" class="info-value"></span>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="d-grid">
                        <a href="#" class="btn btn-primary">
                            <i class="bi bi-key-fill me-2"></i>비밀번호 변경
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 공통 스크립트 -->
<th:block th:replace="~{fragments/common :: common-scripts}"></th:block>

<!-- 상단 바 자바 스크립트 -->
<th:block th:replace="~{fragments/topbar :: topbar-script}"></th:block>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchMyInfo();
    });

    // 내 정보를 서버에서 가져와 화면에 표시하는 함수
    async function fetchMyInfo() {
        const loader = document.getElementById('info-loader');
        const content = document.getElementById('info-content');

        try {
            const response = await fetchWithAuth('/api/members/me');
            if (!response.ok) {
                throw new Error('정보를 불러오는 데 실패했습니다.');
            }

            const result = await response.json();
            const userInfo = result.data;

            // 역할 한글로 변환
            const roleNames = { 'STUDENT': '학생', 'PROFESSOR': '교수', 'ADMIN': '관리자' };

            // 받아온 정보로 화면 업데이트
            document.getElementById('info-loginId').textContent = userInfo.loginId;
            document.getElementById('info-name').textContent = userInfo.name;
            document.getElementById('info-email').textContent = userInfo.email;
            document.getElementById('info-role').textContent = roleNames[userInfo.role] || userInfo.role;

            // 로더 숨기고 컨텐츠 표시
            loader.classList.add('d-none');
            content.classList.remove('d-none');

        } catch (error) {
            console.error('Error fetching user info:', error);
            loader.innerHTML = `<p class="text-center text-danger">${error.message}</p>`;
        }
    }

</script>
</body>
</html>